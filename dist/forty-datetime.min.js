(function(){angular.module("fortyDate",[]).directive("fortyDatePicker",function(a){return{require:"ngModel",restrict:"E",replace:!0,scope:{date:"=ngModel",disabled:"=",name:"=?",placeholder:"=?"},template:'<div class="input-group"><input type="text" class="form-control" datepicker-popup="{{format}}" ng-model="date" name="{{name}}" is-open="opened" placeholder="{{placeholder}}" ng-disabled="disabled" /><span class="input-group-btn"><button type="button" ng-disabled="disabled" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button></span></div>',link:function(b,c){var d,e,f,g,h,i,j,k,l,m;return d=void 0,g=void 0,j=void 0,k=void 0,i=function(){return d=[96,97,98,99,100,101,102,103,104,105],g="/",j=b.format.toLowerCase().replace(/\w/g,"_"),k=angular.element(c.find("input")).data("$ngModelController"),_.isDate(b.date)||k.$setViewValue(j),!0},l=function(a,b){var c;if(a)return a.value=a.value,a.createTextRange?(c=a.createTextRange(),c.move("character",b),c.select(),!0):a.selectionStart||0===a.selectionStart?(a.focus(),a.setSelectionRange(b,b),!0):(a.focus(),!1)},e=function(a){var c,d;return c=0,d=_.map(b.format.split(""),function(b){var d;return b===g?g:(d=a[c],void 0===a[c]&&(d="_"),c++,d)})},h=function(a){return null==a&&(a=void 0),a?c.find("input")[0].value.substr(0,a).replace(/\w/g,"").length:0},f=function(a,d){var f,g,i,j,m,n,o;null==d&&(d=0),(0!==a.selectionStart||0!==d||a.selectionStart!==a.selectionEnd)&&(a.selectionStart!==b.format.length||1!==d)&&(i=a.value.replace(/\W/g,"").split(""),o=a.selectionStart,a.selectionEnd===a.selectionStart&&(o-=1),j=h(o+d),n=h(a.selectionStart),m=h(a.selectionEnd),g=a.selectionEnd-m-(a.selectionStart-n),g=0===g?1:g,i.splice(o-j+d,g),k.$setViewValue(e(i).join("")),k.$render(),f=o+d,l(c.find("input")[0],f))},m=function(a,b){var d,f,h,i,j,m,n;return f=a.value.split(""),n=a.selectionStart,i=a.value.substr(0,n).replace(/\w/g,"").length,h=a.value.replace(/\W/g,"").split(""),j=n-i,h.indexOf("_")<j&&(j=h.indexOf("_")),null!==b&&h.splice(j,0,b),m=e(h).join(""),k.$setViewValue(m),k.$render(),d=f[j+1]===g?2:1,d+=i,l(c.find("input")[0],j+d),m},c.find("input").on("paste",function(a){return a.preventDefault(),this.value=a.clipboardData.getData("text/plain"),m(this,null)}),c.find("input").on("keydown",function(a){var b;return b=a.keyCode||a.which,8===b||46===b?(f(this,8===b?0:1),a.preventDefault(),!1):void 0}),c.find("input").on("keypress",function(a){var d,e;if(e=a.keyCode||a.which,9!==e){if(a.preventDefault(),this.value.replace(/\_/g,"").length===b.format.length)return!1;if(isNaN(parseInt(String.fromCharCode(e))))return!1;d=c.find("input")[0],d.value===j&&l(d,0),m(d,String.fromCharCode(a.keyCode))}}),c.find("input").on("blur",function(){return k.$viewValue!==j?void 0===a("date")(b.date,b.format)?c.addClass("has-error"):c.removeClass("has-error"):void 0}),b.opened=!1,b.format="MM/dd/yyyy",b.placeholder=b.placeholder||"__/__/____",b.open=function(a){a.preventDefault(),a.stopPropagation(),b.opened=!b.opened},i(),k.$parsers.unshift(function(a){return a}),k.$formatters.unshift(function(a){return a})}}})}).call(this);